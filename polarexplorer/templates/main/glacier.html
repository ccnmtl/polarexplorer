{% extends "base.html" %}

{% block title %}
    Calving Glacier
{% endblock %}


{% block content %}
    <div data-role="page">
        <div data-role="header" id="base-header">
            <a href="#about" data-role="button" data-rel="dialog" data-icon="info">About</a>
            <h1 id="header">Calving Glacier</h1>
            <a id="reset" href="#" data-role="button" data-icon="refresh">Reset</a>
        </div>

        <div data-role="content">
            <div class="ui-grid-solo">
                <div class="ui-block-a pageview">                    
                    <div class="glacier glacier_0" data-idx="0">
                    </div>
                </div>
            </div>
        </div>
        
        <div data-role="footer"></div>
    </div>

{% endblock %}

{% block js %}
    <script type="text/javascript">
        var imageCount = 15;
    
        function swipeGlacier() {
            var elt = jQuery(".glacier");
            var imgIdx = parseInt(jQuery(elt).data("idx"), 10);
            var newIdx = (imgIdx + 1) % imageCount;
            
            if (imgIdx < imageCount && newIdx > 0) {
                jQuery(elt).removeClass("glacier_" + imgIdx);
                jQuery(elt).data("idx", newIdx);
                jQuery(elt).addClass("glacier_" + newIdx);
            }
        }
        
        jQuery(document).on("pageinit", function (event) {
            jQuery(".glacier").swipeleft(function(event) {
                event.stopImmediatePropagation();
                swipeGlacier();
                setTimeout(function() { swipeGlacier(); }, 400);
                return false;
            });
            jQuery("#reset").click(function() {
                var elt = jQuery(".glacier");
                var imgIdx = jQuery(elt).data("idx");
                jQuery(elt).removeClass("glacier_" + imgIdx);
                
                imgIdx = 0;
                jQuery(elt).data("idx", imgIdx);
                jQuery(elt).addClass("glacier_" + imgIdx);
                jQuery(window).trigger("resize");
                return false;                
            });
            
            window.onresize=function() {
                var height = window.innerHeight - 
                   (jQuery("div.ui-header").height() + 45);
                jQuery(".pageview").css("height", height + "px");
            };
            
            jQuery(window).trigger("resize");
        });
    </script>
{% endblock %}

